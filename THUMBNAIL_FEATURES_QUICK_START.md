# ç¼©ç•¥å›¾ç³»ç»ŸåŠŸèƒ½å¢å¼º - å¿«é€Ÿå‚è€ƒ

## éœ€æ±‚æ€»ç»“

ä½ æƒ³è¦å®ç° 4 ä¸ªåŠŸèƒ½ï¼š

### 1ï¸âƒ£ è®¾ç½®é¢æ¿é›†æˆ
å°†ç¼©ç•¥å›¾é…ç½®ï¼ˆå¹¶å‘æ•°ã€ç¼“å­˜å¤§å°ç­‰ï¼‰ç§»åˆ°è®¾ç½®ç•Œé¢çš„**æ€§èƒ½ Tab**

**å½“å‰çŠ¶æ€**: é…ç½®ç¡¬ç¼–ç åœ¨ä»£ç ä¸­  
**ç›®æ ‡**: ç”¨æˆ·å¯åœ¨è®¾ç½®ä¸­åŠ¨æ€è°ƒæ•´

```
è®¾ç½® â†’ æ€§èƒ½ Tab
â”œâ”€â”€ ç¼©ç•¥å›¾è®¾ç½®
â”‚   â”œâ”€â”€ æœ¬åœ°æ–‡ä»¶å¹¶å‘æ•°: [4] â†’ [6]
â”‚   â”œâ”€â”€ å‹ç¼©åŒ…å¹¶å‘æ•°: [2] â†’ [3]
â”‚   â”œâ”€â”€ è§†é¢‘å¹¶å‘æ•°: [2]
â”‚   â”œâ”€â”€ ç¼“å­˜å¤§å°: [500MB]
â”‚   â”œâ”€â”€ ç¼©ç•¥å›¾å°ºå¯¸: [256px]
â”‚   â””â”€â”€ å¯ç”¨è§†é¢‘ç¼©ç•¥å›¾: [å¼€å¯]
```

### 2ï¸âƒ£ ç¼©ç•¥å›¾ç®¡ç†é¢æ¿
åœ¨å·¦ä¾§è¾¹æ æ·»åŠ æ–°é¢æ¿ï¼Œæ”¯æŒï¼š
- **ç´¢å¼•æŒ‰é’®**: ä¸€é”®ç´¢å¼•æœªå¤„ç†çš„æ–‡ä»¶
- **è¿›åº¦æ¡**: æ˜¾ç¤ºç´¢å¼•è¿›åº¦
- **ç»Ÿè®¡ä¿¡æ¯**: å·²å¤„ç†/æ€»æ•°/ç¼“å­˜å¤§å°
- **æ§åˆ¶æŒ‰é’®**: æš‚åœ/æ¢å¤/æ¸…ç©ºç¼“å­˜

```
ç¼©ç•¥å›¾ç®¡ç†
â”œâ”€â”€ ğŸ“Š ç»Ÿè®¡
â”‚   â”œâ”€â”€ å·²å¤„ç†: 150/500
â”‚   â”œâ”€â”€ ç¼“å­˜: 245MB
â”‚   â””â”€â”€ é€Ÿåº¦: 12/s
â”œâ”€â”€ â³ è¿›åº¦æ¡ [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘] 60%
â””â”€â”€ ğŸ›ï¸ æ§åˆ¶
    â”œâ”€â”€ å¼€å§‹ç´¢å¼•
    â”œâ”€â”€ æš‚åœ
    â””â”€â”€ æ¸…ç©ºç¼“å­˜
```

### 3ï¸âƒ£ è§†é¢‘æ”¯æŒ
ä½¿ç”¨ FFmpeg ä¸ºè§†é¢‘æ–‡ä»¶ç”Ÿæˆç¼©ç•¥å›¾

**æ”¯æŒæ ¼å¼**: MP4, MKV, AVI, MOV, FLV ç­‰  
**æµç¨‹**: æå–ç¬¬ä¸€å¸§ â†’ ç”Ÿæˆç¼©ç•¥å›¾ â†’ ç¼“å­˜

```
è§†é¢‘æ–‡ä»¶ (video.mp4)
    â†“
FFmpeg æå–å¸§ (10ç§’å¤„)
    â†“
ç”Ÿæˆç¼©ç•¥å›¾ (256x256)
    â†“
ç¼“å­˜åˆ°ç£ç›˜
    â†“
æ˜¾ç¤ºåœ¨æ–‡ä»¶åˆ—è¡¨
```

### 4ï¸âƒ£ ç»Ÿä¸€ç¼“å­˜æµç¨‹
æ‰€æœ‰ç±»å‹ï¼ˆå›¾ç‰‡ã€å‹ç¼©åŒ…ã€è§†é¢‘ï¼‰ä½¿ç”¨åŒä¸€å¥—ç¼“å­˜ç³»ç»Ÿ

```
æ–‡ä»¶ç±»å‹ â†’ ç¼“å­˜é”® â†’ ç¼“å­˜æŸ¥è¯¢ â†’ ç¼“å­˜å­˜å‚¨
â”œâ”€â”€ å›¾ç‰‡: image::/path/to/file.jpg
â”œâ”€â”€ å‹ç¼©åŒ…: archive::/path/to/file.zip
â””â”€â”€ è§†é¢‘: video::/path/to/file.mp4
```

---

## å®ç°ä¼˜å…ˆçº§

### ğŸ”´ å¿…åš (ç¬¬ 1-2 å‘¨)
1. **è®¾ç½®é¢æ¿é›†æˆ** - åŸºç¡€ï¼Œå…¶ä»–åŠŸèƒ½ä¾èµ–
2. **ç¼©ç•¥å›¾ç®¡ç†é¢æ¿** - æ ¸å¿ƒåŠŸèƒ½

### ğŸŸ¡ åº”åš (ç¬¬ 3-4 å‘¨)
3. **è§†é¢‘æ”¯æŒ** - å¢åŠ åŠŸèƒ½å®Œæ•´æ€§
4. **ç»Ÿä¸€ç¼“å­˜** - ä¼˜åŒ–å’Œå®Œå–„

### ğŸŸ¢ å¯åš (åç»­)
- AI é©±åŠ¨çš„ç¼©ç•¥å›¾é€‰æ‹©
- äº‘åŒæ­¥æ”¯æŒ
- é«˜çº§ç»Ÿè®¡åˆ†æ

---

## å…³é”®æ–‡ä»¶æ¸…å•

### éœ€è¦ä¿®æ”¹
```
src/lib/types/settings.ts                    â† æ·»åŠ ç¼©ç•¥å›¾é…ç½®ç±»å‹
src/lib/components/panels/SettingsPanel.svelte â† æ·»åŠ  UI
src/lib/settings/settingsManager.ts          â† é…ç½®æŒä¹…åŒ–
src/lib/components/panels/FileBrowser.svelte â† è¯»å–é…ç½®
src/lib/utils/thumbnailManager.ts           â† æ”¯æŒå¤šç±»å‹
src-tauri/src/core/thumbnail.rs             â† åç«¯é€»è¾‘
```

### éœ€è¦æ–°å¢
```
src/lib/components/panels/ThumbnailPanel.svelte [æ–°å¢]
src/lib/stores/thumbnail.svelte.ts            [æ–°å¢]
src-tauri/src/core/video_thumbnail.rs         [æ–°å¢]
src-tauri/src/commands/video_commands.rs      [æ–°å¢]
```

---

## æŠ€æœ¯æ–¹æ¡ˆ

### å‰ç«¯æ¶æ„
```
SettingsPanel
    â†“ (è¯»å–)
settingsManager
    â†“ (åº”ç”¨)
FileBrowser
    â†“ (è°ƒç”¨)
thumbnailManager
    â†“ (IPC)
Tauri åç«¯
```

### åç«¯æ¶æ„
```
ThumbnailManager
â”œâ”€â”€ å›¾ç‰‡å¤„ç† (image crate)
â”œâ”€â”€ å‹ç¼©åŒ…å¤„ç† (zip crate)
â””â”€â”€ è§†é¢‘å¤„ç† (FFmpeg)
    â†“
ThumbnailDatabase (SQLite)
    â†“
ç¼“å­˜å­˜å‚¨ (~/.neoview/cache/)
```

### ç¼“å­˜é”®æ ¼å¼
```
type::path::identifier

ç¤ºä¾‹:
- image::/home/user/pic.jpg
- archive::/home/user/book.zip
- video::/home/user/movie.mp4
- video::/home/user/movie.mp4::10  (10ç§’å¤„)
```

---

## é…ç½®è¿ç§»

### å½“å‰ç¡¬ç¼–ç å€¼
```typescript
// thumbnailManager.ts
const FIRST_SCREEN = 50;
const SECOND_SCREEN = 100;
const maxConcurrentLocal = 6;
const maxConcurrentArchive = 3;
```

### è¿ç§»åˆ°è®¾ç½®
```typescript
// settings.ts
interface ThumbnailSettings {
  maxConcurrentLocal: number;      // 6
  maxConcurrentArchive: number;    // 3
  maxConcurrentVideo: number;      // 2
  cacheSize: number;               // 500MB
  thumbnailSize: number;           // 256px
  enableVideoThumbnail: boolean;   // true
}
```

### åŠ¨æ€åº”ç”¨
```typescript
// FileBrowser.svelte
const settings = await settingsManager.getThumbnailSettings();
configureThumbnailManager({
  maxConcurrentLocal: settings.maxConcurrentLocal,
  maxConcurrentArchive: settings.maxConcurrentArchive,
});
```

---

## ç´¢å¼•æµç¨‹

### ç”¨æˆ·æ“ä½œ
```
ç”¨æˆ·ç‚¹å‡» "å¼€å§‹ç´¢å¼•"
    â†“
é€‰æ‹©è¦ç´¢å¼•çš„ç›®å½•
    â†“
æ‰«ææ‰€æœ‰æ–‡ä»¶
    â†“
è¿‡æ»¤æœªå¤„ç†çš„æ–‡ä»¶
    â†“
å…¥é˜Ÿå¤„ç†
    â†“
å®æ—¶æ˜¾ç¤ºè¿›åº¦
    â†“
å®Œæˆåæ˜¾ç¤ºç»Ÿè®¡
```

### åç«¯å¤„ç†
```
æ¥æ”¶ç´¢å¼•è¯·æ±‚
    â†“
æ‰«æç›®å½•æ ‘
    â†“
æ£€æŸ¥ç¼“å­˜
    â†“
è¯†åˆ«æ–‡ä»¶ç±»å‹
    â†“
åˆ†é…åˆ°å¯¹åº”å¤„ç†å™¨
    â†“
å¹¶å‘å¤„ç†
    â†“
ä¿å­˜ç¼“å­˜
    â†“
æ›´æ–°æ•°æ®åº“
```

---

## æ€§èƒ½æŒ‡æ ‡

### ç›®æ ‡
- é¦–å±åŠ è½½: <500ms
- å®Œæ•´åŠ è½½: <3s
- ç´¢å¼•é€Ÿåº¦: >10 ç¼©ç•¥å›¾/ç§’
- å†…å­˜å ç”¨: <200MB

### å¹¶å‘é…ç½®
- æœ¬åœ°æ–‡ä»¶: 6-8 (CPU å¯†é›†)
- å‹ç¼©åŒ…: 3-4 (I/O å¯†é›†)
- è§†é¢‘: 2-3 (FFmpeg èµ„æºå¯†é›†)

---

## é£é™©å’Œè§£å†³æ–¹æ¡ˆ

| é—®é¢˜ | è§£å†³æ–¹æ¡ˆ |
|------|---------|
| FFmpeg ä¸å¯ç”¨ | è‡ªåŠ¨æ£€æµ‹ï¼Œæä¾›ä¸‹è½½é“¾æ¥ |
| æ€§èƒ½ä¸‹é™ | å……åˆ†çš„å¹¶å‘æ§åˆ¶å’Œæµ‹è¯• |
| ç¼“å­˜ä¸ä¸€è‡´ | å®Œå–„çš„å¤±æ•ˆæœºåˆ¶ |
| å†…å­˜æº¢å‡º | é™åˆ¶ç¼“å­˜å¤§å°ï¼Œå®šæœŸæ¸…ç† |

---

## æµ‹è¯•æ¸…å•

### åŠŸèƒ½æµ‹è¯•
- [ ] è®¾ç½®ä¿å­˜å’ŒåŠ è½½
- [ ] é…ç½®å®æ—¶åº”ç”¨
- [ ] ç´¢å¼•åŠŸèƒ½
- [ ] è¿›åº¦æ˜¾ç¤º
- [ ] è§†é¢‘ç¼©ç•¥å›¾
- [ ] ç¼“å­˜ä¸€è‡´æ€§

### æ€§èƒ½æµ‹è¯•
- [ ] 1000+ æ–‡ä»¶ç´¢å¼•
- [ ] å†…å­˜å ç”¨
- [ ] CPU ä½¿ç”¨ç‡
- [ ] ç¼“å­˜å‘½ä¸­ç‡

### å…¼å®¹æ€§æµ‹è¯•
- [ ] ä¸åŒæ–‡ä»¶æ ¼å¼
- [ ] ä¸åŒç³»ç»Ÿ (Windows/Mac/Linux)
- [ ] FFmpeg ç‰ˆæœ¬

---

## æ—¶é—´ä¼°è®¡

| é˜¶æ®µ | ä»»åŠ¡ | æ—¶é—´ |
|------|------|------|
| 1 | è®¾ç½®é¢æ¿é›†æˆ | 1-2 å¤© |
| 2 | ç®¡ç†é¢æ¿ | 2-3 å¤© |
| 3 | è§†é¢‘æ”¯æŒ | 3-4 å¤© |
| 4 | ç»Ÿä¸€ç¼“å­˜ | 2-3 å¤© |
| 5 | æµ‹è¯•å’Œä¼˜åŒ– | 2-3 å¤© |
| **æ€»è®¡** | | **12-18 å¤©** |

---

## å¿«é€Ÿå¼€å§‹æ­¥éª¤

### ç¬¬ 1 å¤©: è®¾ç½®é¢æ¿
1. æ‰©å±• `settings.ts` ç±»å‹
2. ä¿®æ”¹ `SettingsPanel.svelte` UI
3. ä¿®æ”¹ `settingsManager.ts` æŒä¹…åŒ–
4. æµ‹è¯•é…ç½®ä¿å­˜/åŠ è½½

### ç¬¬ 2-3 å¤©: ç®¡ç†é¢æ¿
1. åˆ›å»º `ThumbnailPanel.svelte`
2. åˆ›å»º `thumbnail.svelte.ts` store
3. å®ç°ç´¢å¼•é€»è¾‘
4. å®ç°è¿›åº¦æ˜¾ç¤º

### ç¬¬ 4-7 å¤©: è§†é¢‘æ”¯æŒ
1. åˆ›å»º `video_thumbnail.rs`
2. é›†æˆ FFmpeg
3. åˆ›å»º Tauri å‘½ä»¤
4. å‰ç«¯é›†æˆ

### ç¬¬ 8-10 å¤©: ç»Ÿä¸€ç¼“å­˜
1. ç»Ÿä¸€ç¼“å­˜é”®æ ¼å¼
2. å®ç°é€šç”¨æŸ¥è¯¢æ¥å£
3. å®ç°å¤±æ•ˆæœºåˆ¶
4. ä¿®æ”¹å„å¤„ç†å™¨

### ç¬¬ 11-18 å¤©: æµ‹è¯•å’Œä¼˜åŒ–
1. å•å…ƒæµ‹è¯•
2. é›†æˆæµ‹è¯•
3. æ€§èƒ½æµ‹è¯•
4. æ–‡æ¡£ç¼–å†™

---

## ä¸‹ä¸€æ­¥

1. **ç¡®è®¤éœ€æ±‚** - ç¡®è®¤ä¸Šè¿° 4 ä¸ªåŠŸèƒ½æ˜¯å¦å®Œæ•´
2. **ç¡®è®¤ä¼˜å…ˆçº§** - æ˜¯å¦æŒ‰ç…§å»ºè®®çš„é¡ºåºå®ç°
3. **ç¡®è®¤æ—¶é—´** - æ˜¯å¦ 12-18 å¤©çš„ä¼°è®¡å¯æ¥å—
4. **å¼€å§‹å®ç°** - ä»é˜¶æ®µ 1 å¼€å§‹

---

**ç‰ˆæœ¬**: 1.0  
**æœ€åæ›´æ–°**: 2024-11-15  
**çŠ¶æ€**: è§„åˆ’å®Œæˆï¼Œç­‰å¾…ç¡®è®¤
