# ç¼©ç•¥å›¾ä¼˜åŒ– - å¿«é€Ÿå‚è€ƒ

## ğŸš€ ä¸»è¦ API

### æ‰¹é‡åŠ è½½ç¼©ç•¥å›¾
```typescript
// æ‰¹é‡ä»æ•°æ®åº“åŠ è½½
const results = await thumbnailManager.batchLoadFromDb(paths);
// è¿”å› Map<path, blobUrl>
```

### å–æ¶ˆä»»åŠ¡
```typescript
// å–æ¶ˆæ‰€æœ‰ä»»åŠ¡ï¼ˆä¿ç•™ç¼“å­˜ï¼‰
thumbnailManager.cancelAllTasks();

// å–æ¶ˆæŒ‡å®šç›®å½•å¤–çš„ä»»åŠ¡
thumbnailManager.setCurrentDirectory(newPath); // è‡ªåŠ¨å–æ¶ˆæ—§ç›®å½•ä»»åŠ¡
```

### é¢„åŠ è½½
```typescript
// æ‰¹é‡é¢„åŠ è½½ï¼ˆè‡ªåŠ¨ä½¿ç”¨æ‰¹é‡æŸ¥è¯¢ï¼‰
await thumbnailManager.preloadThumbnails(items, currentPath, 'immediate');
```

## ğŸ“Š æ€§èƒ½å¯¹æ¯”

| æ“ä½œ | ä¼˜åŒ–å‰ | ä¼˜åŒ–å |
|------|--------|--------|
| åŠ è½½ 100 ä¸ªç¼©ç•¥å›¾ | 100-500ms | 20-60ms |
| æ•°æ®åº“æŸ¥è¯¢æ¬¡æ•° | 100 æ¬¡ | 2 æ¬¡ |
| åˆ‡æ¢æ–‡ä»¶å¤¹æ¸…ç† | âŒ ä»»åŠ¡ç»§ç»­æ‰§è¡Œ | âœ… è‡ªåŠ¨å–æ¶ˆ |
| ç¼“å­˜ç®¡ç† | âŒ å¯èƒ½è¢«æ¸…ç©º | âœ… ä¿ç•™ç¼“å­˜ |

## ğŸ¯ ä¼˜åŒ–è¦ç‚¹

1. **æ‰¹é‡ä¼˜å…ˆ** - ä¸€æ¬¡æŸ¥è¯¢å¤šä¸ªï¼ˆ50 ä¸ª/æ‰¹ï¼‰
2. **å¯è§ä¼˜å…ˆ** - è™šæ‹Ÿåˆ—è¡¨å¯è§èŒƒå›´ä¼˜å…ˆåŠ è½½
3. **æ™ºèƒ½å–æ¶ˆ** - åˆ‡æ¢æ–‡ä»¶å¤¹è‡ªåŠ¨å–æ¶ˆæ—§ä»»åŠ¡
4. **ç¼“å­˜ä¿ç•™** - å–æ¶ˆä»»åŠ¡ä¸å½±å“å·²æœ‰ç¼“å­˜

## ğŸ“ ä¿®æ”¹çš„æ–‡ä»¶

### åç«¯
- `src-tauri/src/commands/thumbnail_commands.rs`
- `src-tauri/src/lib.rs`

### å‰ç«¯
- `src/lib/utils/thumbnailManager.ts`
- `src/lib/components/panels/file/components/VirtualizedFileList.svelte`

## ğŸ”§ é…ç½®å‚æ•°

```typescript
// ThumbnailManager
BATCH_LOAD_SIZE = 50  // æ‰¹é‡å¤§å°
MAX_QUEUE_SIZE = 20000  // æœ€å¤§é˜Ÿåˆ—
MAX_PROCESSING = 400  // æœ€å¤§å¹¶å‘

// VirtualizedFileList
BATCH_SIZE = 50  // æ‰¹é‡æŸ¥è¯¢å¤§å°
overscan = 5  // é¢„æ¸²æŸ“æ•°é‡
```

## ğŸ’¡ ä½¿ç”¨å»ºè®®

### âœ… æ¨è
- è¿›å…¥æ–‡ä»¶å¤¹æ—¶ä½¿ç”¨ `preloadThumbnails()`
- è®©è™šæ‹Ÿåˆ—è¡¨è‡ªåŠ¨å¤„ç†æ»šåŠ¨èŒƒå›´
- ä¾èµ–è‡ªåŠ¨ä»»åŠ¡å–æ¶ˆæœºåˆ¶

### âŒ é¿å…
- æ‰‹åŠ¨é€ä¸ªè°ƒç”¨ `getThumbnail()`ï¼ˆé™¤éå¿…è¦ï¼‰
- é¢‘ç¹è°ƒç”¨ `cancelAllTasks()`
- ä¿®æ”¹æ‰¹é‡å¤§å°é…ç½®ï¼ˆé™¤éæœ‰æ€§èƒ½é—®é¢˜ï¼‰

## ğŸ§ª æµ‹è¯•åœºæ™¯

1. è¿›å…¥å¤§æ–‡ä»¶å¤¹ï¼ˆ500+ æ–‡ä»¶ï¼‰
2. å¿«é€Ÿæ»šåŠ¨è™šæ‹Ÿåˆ—è¡¨
3. é¢‘ç¹åˆ‡æ¢æ–‡ä»¶å¤¹
4. è¿”å›ä¹‹å‰çš„æ–‡ä»¶å¤¹

æœŸæœ›ï¼š
- å·²ç¼“å­˜ï¼šç«‹å³æ˜¾ç¤º
- æœªç¼“å­˜ï¼šæŒ‰é¡ºåºæ˜¾ç¤º
- æ»šåŠ¨ï¼šæµç•…æ— å¡é¡¿
- åˆ‡æ¢ï¼šæ—§ä»»åŠ¡è‡ªåŠ¨å–æ¶ˆ
